#!/usr/bin/env python3
"""
Squad API - QuickStart
Template básico para prototipagem rápida
"""

import os
import sys
import asyncio
import logging

# Set up logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def main():
    """Quick start the Squad API"""

    # Check environment
    required_env = ['GROQ_API_KEY', 'GEMINI_API_KEY', 'CEREBRAS_API_KEY']
    missing = [k for k in required_env if not os.getenv(k)]

    if missing:
        print(f"[WARNING] Missing API keys: {', '.join(missing)}")
        print("[INFO] API will work but these providers will fail")

    # Import after environment check
    from fastapi import FastAPI
    from fastapi.middleware.cors import CORSMiddleware
    import uvicorn

    app = FastAPI(
        title="Squad API - {{ project_name }}",
        description="Multi-Agent LLM Orchestration Platform",
        version="1.0.0"
    )

    # Add CORS
    app.add_middleware(
        CORSMiddleware,
        allow_origins=["*"],
        allow_credentials=True,
        allow_methods=["*"],
        allow_headers=["*"],
    )

    # Basic agent route
    @app.post("/agent/{agent_type}")
    async def execute_agent(agent_type: str, request: dict):
        """Execute agent with basic fallback"""

        # Mock response for basic template
        return {
            "agent": agent_type,
            "response": f"Hello from {agent_type} agent! This is {{ project_name }} basic template.",
            "provider": "mock",
            "template": "basic",
            "project": "{{ project_name }}"
        }

    # Health check endpoint
    @app.get("/health")
    async def health():
        return {
            "status": "operational",
            "version": "1.0.0",
            "template": "basic",
            "project": "{{ project_name }}",
            "providers": {{ providers | tojson }}
        }

    @app.get("/")
    async def root():
        return {
            "message": "Squad API - {{ project_name }} (Basic Template)",
            "docs": "http://localhost:8000/docs",
            "health": "http://localhost:8000/health"
        }

    # Start server
    print("\n" + "="*60)
    print("Squad API - {{ project_name }} - Starting...")
    print("="*60)
    print("[INFO] Template: Basic")
    print("[INFO] API: http://localhost:8000")
    print("[INFO] Docs: http://localhost:8000/docs")
    print("[INFO] Health: http://localhost:8000/health")
    print("="*60 + "\n")

    config = uvicorn.Config(
        app,
        host="127.0.0.1",
        port=8000,
        reload=True,
        log_level="info"
    )

    server = uvicorn.Server(config)
    await server.serve()

if __name__ == "__main__":
    asyncio.run(main())
